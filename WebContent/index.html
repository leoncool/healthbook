<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge">-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Market Place</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/custom-styles.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]>
    <script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="js/jquery-1.11.1.js"></script>
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/jquery.confirm.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

</head>

<body>


<!--Header-->


<div class="navbar navbar-inverse nav-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span
                    class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span
                    class="icon-bar"></span> <span class="icon-bar"></span></button>
            <a class="navbar-brand" href="#"> <img src="img/logo.png" alt="logo" class="img-responsive"> </a></div>


        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-left">
                <li class="active"><a href="#">My Health</a></li>
                <li><a href="#">News Feed</a></li>
                <li><a href="#">Community</a></li>
                <li><a href="#">Events</a></li>
                <li><a href="#">Groups</a></li>
            </ul>
            <div class="navbar-form navbar-right">
                <a class="pull-left" href="#"> <img class="img-circle img-responsive" src="img/user.png" alt="avatar"/>
                </a>

                <div class="btn-group top-user">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"> LEON <span
                            class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li class="active"><a href="#">Info</a></li>

                        <li class="divider"></li>
                        <li><a href="#">Log Out</a></li>
                    </ul>
                </div>


            </div>
        </div>
    </div>
</div>


<!--End Header -->


<div class="clearfix"></div>

<!-- Main Container -->

<div class="container">
    <div class="row text-center">
        <h1 class="page-head"><img src="img/bucket.png" width="51" height="51"> Data and Models Marketplace</h1>

    </div>


    <div class="gap"></div>
    <div class="row grey ">

        <!--Sidebar -->
        <div class="col-xs-12 col-md-3 col-sm-3 col-lg-3 sidebar">
            <ul class="nav nav-sidebar" id="model_list_sidebar">
                <!--<li id="" class="active"><a href="#"><span class="glyphicon glyphicon-heart"></span> ECG Beat-->
                    <!--Detector</a></li>-->
                <!--<li><a href="#"> <span class="glyphicon glyphicon-heart"></span> ECG QRS Detector </a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-random"></span> ECG Abnormal Detector</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-user"></span> ECG Personal Abnormal</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-star"></span> ECG Emotion Detector</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-screenshot"></span> EEG Motion Detetor</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-fire"></span> Human Body Temp Model</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-tint"></span> Calorie Cal using ECG</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-bookmark"></span> Calorie Cal using Steps</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-list"></span> Calorie Cal using Body</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-calendar"></span> Steps Calculator</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-repeat"></span> Sleep Cycle Alarm Clock</a></li>-->
                <!--<li><a href="#"><span class="glyphicon glyphicon-plus"></span> More</a></li>-->
            </ul>


            <div class="gap"></div>
        </div>
        <!--End Sidebar-->

        <!--Content Container-->

        <div class="col-sm-9 col-md-9 col-xs-12 col-lg-9 main white">
            <div class="page-header page">

                <h1 class="model-head">Model Details</h1>

                <div class="clearfix"></div>
            </div>


            <!--Content-->

            <h3 class="pull-left product"><img src="img/ecg.png" width="26" height="26" class="pull-left ico"><span
                    id="model_name_span">Undefined</span></h3>

            <div class="price pull-right" id="model_price_div"></div>
            <div class="clearfix"></div>
            <hr>

            <h4 class="model-head2">Description</h4>

            <p id="model_description">

            </p>

            <!--<h4 class="model-head2">Requirement Permissions</h4>-->

            <!--<ul class="points" id="required_permissions">-->

                <!--<li>ECG Sensor Data Stream Read/Write Permissions</li>-->
                <!--<li>Height Weight Age Information</li>-->

            </ul>

            <h4 class="model-head2">Required Inputs and Permissions</h4>

            <ul class="points" id="required_inputs">

                <!--<li>ECG Sensor Data Stream </li>-->


            </ul>
            <h4 class="model-head2">Terms &amp; Conditions</h4>

            <p id="terms_conditions">

                <!--<em> Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.<br>-->
                <!--<br>-->

                <!--Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Epsum factorial non deposit quid pro quo hic escorol.</em>-->
                <!---->

            </p>
            <h4 class="model-head2">User Reviews</h4>


            <div class="media review">
                <a class="pull-left" href="#">
                    <img class="media-object img-circle" alt="64x64" src="img/user1.png"
                         style="width: 51px; height: 51px;">
                </a>

                <div class="media-body">
                    <h4 class="media-heading title">Just Great!</h4>

                    <div class="user-name">by Steve Mclaren</div>
                    <hr class="hairline">
                    <em>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod
                        tincidunt ut laoreet dolore magna aliquam erat volutpat.<br>
                        <br>

                        Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut
                        aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit
                        esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et
                        iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait
                        nulla facilisi. Epsum factorial non deposit quid pro quo hic escorol.</em>
                </div>
            </div>


            <div class="media review">
                <a class="pull-left" href="#">
                    <img class="media-object img-circle" alt="64x64" src="img/user2.png"
                         style="width: 51px; height: 51px;">
                </a>

                <div class="media-body">
                    <h4 class="media-heading title">Fantastic Model!</h4>

                    <div class="user-name">by John Smith</div>
                    <hr class="hairline">
                    <em>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod
                        tincidunt ut laoreet dolore magna aliquam erat volutpat.<br>
                        <br>
                    </em>
                </div>
            </div>

            <hr>


            <div class="clearfix"></div>

            <button class="btn btn-primary btn-lg pull-right" id="buy_now_button">Buy Now</button>


            <!--End Content-->

            <div class="gap"></div>

            <br>
            <br>
            <br>
            <br>

            <div class="clearfix"></div>
        </div>

        <!--End Content Container-->

    </div>


</div>
<!--End Main Container -->
<div class="gap"></div>
<!--Footer -->

<div class="footer">
    <div class="container">
        <div class="col-lg-4">
            <h3 class="foot-head">Browse Site</h3>

            <ul class="footlinks col-lg-6 col-xs-6">
                <li><a href="#">Home</a></li>
                <li><a href="#">Overview</a></li>
                <li><a href="#">Login</a></li>
            </ul>
            <ul class="footlinks col-lg-6 col-xs-6">

                <li><a href="#">Register</a></li>
                <li><a href="#">Publish Service</a></li>
                <li><a href="#">Contact Us</a></li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="col-lg-3">
            <h3 class="foot-head">Keep In Touch</h3>

            <p class="touch-txt">Connect to us.</p>
            <a href="#"><img src="img/fb.png" width="32" height="32"></a>
            <a href="#"><img src="img/twtr.png" width="32" height="32"></a>

        </div>

        <div class="col-lg-3 pull-right visible-lg">

            <input type="text" class="form-control" placeholder="Search Site">


        </div>

    </div>

</div>


<script type="text/javascript">
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
        return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }


    // Attach a submit handler to the form
    $(document).ready(function () {

        var model_id = getParameterByName('model_id');

        if (model_id == "" || model_id == undefined || model_id == null) {
            model_id='2bae6ecd-40fa-419f-bd41-879f0c48adbb';
        }
        var urlGetModelMetadata='http://localhost:8080/healthbook/GetModelMetadata?model_id='+model_id;
        var getModelMetadata = {
            target: '#output',   // target element(s) to be updated with server response
            beforeSubmit: showRequest,  // pre-submit callback
            success: showResponse,  // post-submit callback

            // other available options:
            url: urlGetModelMetadata,        // override for form's 'action' attribute
            type: 'post',      // 'get' or 'post', override for form's 'method' attribute
            dataType: 'json'        // 'xml', 'script', or 'json' (expected server response type)
            //clearForm: true        // clear all form fields after successful submit
            //resetForm: true        // reset the form after successful submit

            // $.ajax options can be used here too, for example:
            //timeout:   3000
        };
        $(this).ajaxSubmit(getModelMetadata);
        var getAllModels = {
            target: '#output',   // target element(s) to be updated with server response
            beforeSubmit: function (formData, jqForm, options) {
                $body = $("body");
                $body.addClass("loading");


                var queryString = $.param(formData);

                var formElement = jqForm[0];

                return true;
            },  // pre-submit callback
            success: function (responseText, statusText, xhr, $form) {
                $body = $("body");
                $body.removeClass("loading");

                var result = responseText;
                if (result.result == 'succeed') {
                    for (var i = 0; i < result.model_list.length; i++) {
                        if (getParameterByName('model_id') == result.model_list[i].id) {
                            $('#model_list_sidebar').append('  <li class="active"><a href="?model_id=' + result.model_list[i].id + '"> <span class="glyphicon glyphicon-heart"></span>' + result.model_list[i].name + '</a></li>')
                        } else {
                            $('#model_list_sidebar').append('  <li><a href="?model_id=' + result.model_list[i].id + '"> <span class="glyphicon glyphicon-heart"></span>' + result.model_list[i].name + '</a></li>')
                        }
                    }

                } else {
                    alert(result.errorCode + ",targetObject:" + result.targetObject);
                }
            },  // post-submit callback

            url: "http://localhost:8080/healthbook/GetModels",        // override for form's 'action' attribute
            type: 'post',      // 'get' or 'post', override for form's 'method' attribute
            dataType: 'json'        // 'xml', 'script', or 'json' (expected server response type)

        };
        $(this).ajaxSubmit(getAllModels)

        $("#buy_now_button").click(function(){
//            window.location ='';
            var answer = confirm("Confirm to buy?")
            if (answer){
                var buyModel = {
                    target: '#output',   // target element(s) to be updated with server response
                    beforeSubmit: function (formData, jqForm, options) {
                        $body = $("body");
                        $body.addClass("loading");

                        var queryString = $.param(formData);

                        var formElement = jqForm[0];

                        return true;
                    },  // pre-submit callback
                    success: function (responseText, statusText, xhr, $form) {
                        $body = $("body");
                        $body.removeClass("loading");

                        var result = responseText;
                        if (result.result == 'succeed') {
                            var service_id=result.service.id;
                            $.cookie("service_id", service_id, { expires: 1 });
                        } else {
                            alert(result.errorCode + ",targetObject:" + result.targetObject);
                        }
                    },  // post-submit callback

                    // other available options:
                    url: "http://localhost:8080/healthbook/PurchaseModel?model_id="+model_id,        // override for form's 'action' attribute
                    type: 'post',      // 'get' or 'post', override for form's 'method' attribute
                    dataType: 'json'        // 'xml', 'script', or 'json' (expected server response type)
                    //clearForm: true        // clear all form fields after successful submit
                    //resetForm: true        // reset the form after successful submit

                    // $.ajax options can be used here too, for example:
                    //timeout:   3000
                };

                $(this).ajaxSubmit(buyModel)
            }
            else{

            }
        })
    });

    // pre-submit callback
    function showRequest(formData, jqForm, options) {
        $body = $("body");
        $body.addClass("loading");


        var queryString = $.param(formData);

        var formElement = jqForm[0];

        return true;
    }

    // post-submit callback
    function showResponse(responseText, statusText, xhr, $form) {
        $body = $("body");
        $body.removeClass("loading");

        var result = responseText;
        if (result.result == 'succeed') {
            $('#model_name_span').html(result.model.name);
            $('#model_description').html(result.model.desp);
            $('#terms_conditions').html(result.model.terms);
            if(result.model.price<=0)
            {
                $('#model_price_div').html('Price: Free to use');
            }else{
            $('#model_price_div').html('Price:'+result.model.price);
            }
            for(var i=0;i<result.inputs.length;i++)
            {
                $('#required_inputs').append('  <li>Acesss your stored '+result.inputs[i].entry_name+' </li>');
            }


        } else {
            alert(result.errorCode + ",targetObject:" + result.targetObject);
        }
    }
</script>

<div class="modal"><!-- Place at bottom of page --></div>
</body>
</html>

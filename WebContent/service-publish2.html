<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--<meta http-equiv="X-UA-Compatible" content="IE=edge">-->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>Service Publisher</title>

<!-- Bootstrap core CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="css/custom-styles.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy this line! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>

    <![endif]-->
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.cookie.js"></script>
</head>

<body>


<!--Header-->


<div class="navbar navbar-inverse nav-top" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
      <a class="navbar-brand" href="#"> <img src="img/logo.png" alt="logo" class="img-responsive"> </a> </div>
  
  
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-left">
        <li class="active"><a href="#">My Health</a></li>
        <li><a href="#">News Feed</a></li>
        <li><a href="#">Community</a></li>
        <li><a href="#">Events</a></li>
         <li><a href="#">Groups</a></li>
      </ul>
      <div class="navbar-form navbar-right">
       <a class="pull-left" href="#"> <img class="img-circle img-responsive" src="img/user.png" alt="avatar" /> </a>
          
            <div class="btn-group top-user">
              <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"> LEON <span class="caret"></span> </button>
              <ul class="dropdown-menu" role="menu">
                <li class="active"><a href="#">Info</a></li>
                
                <li class="divider"></li>
                <li><a href="#">Log Out</a></li>
              </ul>
            </div>
          
       
      </div>
    </div>
  </div>
</div>


<!--End Header -->



<div class="clearfix"></div>

<!-- Main Container -->

<div class="container">
<div class="row text-center">
<h1 class="page-head"><img src="img/model.png" >  Model Publisher</h1>

</div>

  
  <div class="gap"></div>
  <div class="row ">
 
  
  <!--Content Container-->
    
    <div class="col-sm-12 col-md-12 col-xs-12 col-lg-12 main white">
      <div class="page-header page">
       
       <h1 class="model-head"><img src="img/ecg.png" width="26" height="26" class="pull-left ico"> Step 2. Please configure your model </h1>
          
        <div class="clearfix"></div>
      </div>


      <div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"> Function Information </h3>
  </div>
  <div class="panel-body">

      <br>

    <form id="model_form" class="form-horizontal" role="form">
        <input type="hidden" name="model_id" id="model_id_input">
        <h1 class="service-head">Register inputs for the Main Function of your uploaded model</h1>
        <div class="clearfix"></div>


        <div class="form-group">
            <label style="color: blue"  class="col-sm-4 control-label">Total Number of Inputs read from your model</label>

            <div class="col-sm-6">
                <label style="color: blue" class="col-sm-2 control-label" id="num_inputs"></label>
            </div>
        </div>
        <div id="input_entry_div">


        </div>


        <h1 class="service-head">Register outputs for the Main Function of your uploaded model</h1>


        <div class="form-group">
            <label style="color: blue"  class="col-sm-4 control-label">Total Number of Outputs read from your model</label>

            <div class="col-sm-6">
                <label  class="col-sm-2 control-label" id="num_outputs">5</label>
            </div>
        </div>

        <div id="output_entry_div">


        </div>




       
       <button class="btn btn-success btn-lg pull-right" type="submit" >Submit Information</button>

        </form>
 
      <!--End Content-->
      
      <div class="gap"></div>


<br>
    </div>
    
  <!--End Content Container-->
    
  </div>

</div>
<!--End Main Container -->
<div class="gap"></div>
<!--Footer -->

<div class="footer">
    <div class="container">
        <div class="col-lg-4">
            <h3 class="foot-head">Browse Site</h3>

            <ul class="footlinks col-lg-6 col-xs-6">
                <li><a href="#">Home</a></li>
                <li><a href="#">Overview</a></li>
                <li><a href="#">Login</a></li>
            </ul>
            <ul class="footlinks col-lg-6 col-xs-6">

                <li><a href="#">Register</a></li>
                <li><a href="#">Publish Service</a></li>
                <li><a href="#">Contact Us</a></li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="col-lg-3">
            <h3 class="foot-head">Keep In Touch</h3>
            <p class="touch-txt">Connect to us.</p>
            <a href="#"><img src="img/fb.png" width="32" height="32"></a>
            <a href="#"><img src="img/twtr.png" width="32" height="32"></a>

        </div>
  
  <div class="col-lg-3 pull-right visible-lg">

      <input type="text" class="form-control"  placeholder="Search Site">


  
  </div>
  
  
  </div>
  
  </div>

<!--End Footer -->

<script type="text/javascript">
    var model_id="";
    var totalInputs=0;
    var totalOutputs=0;
    // Attach a submit handler to the form
    $(document).ready(function() {

        if($.cookie("model_id")==undefined||$.cookie("totalInputs")==undefined||$.cookie("totalOutputs")==undefined)
        {
            alert("Error - Please ensure cookie is enabled!");
            parent.history.back();
            return false;
        }
        model_id=$.cookie("model_id");
        totalInputs=$.cookie("totalInputs");
        totalOutputs=$.cookie("totalOutputs");
        if(model_id==""||model_id==undefined||totalInputs<1||totalOutputs<1)
        {
            alert("There is some data missing, please go back to previous page and upload your model again!");
            return;
        }
        $("#model_id_input").val(model_id);
        $("#num_inputs").text(totalInputs);
        $("#num_outputs").text(totalOutputs);
        totalInputs=$.cookie("totalInputs");
        totalOutputs=$.cookie("totalOutputs");
        for(var i=0;i<totalInputs;i++)
        {
            var entry_base='input'+(i+1);
            var type_entry=entry_base+'_type';
            var desp_entry=entry_base+'_desp';
            var name_entry=entry_base+'_name';
            var validation_entry=entry_base+'_validation';
            $("#input_entry_div").append('' +
                    ' <div class="form-group"> ' +
                    '<label for="" class="col-sm-3 control-label">'+entry_base+' Data Type <span class="sub-tag">This Field is Required</span></label> ' +
                    '<div class="col-sm-4 padding-less"> <select name="'+type_entry+'" class="form-control"> ' +
                    '<option value="sensordata">Sensor Data</option> <option value="file">File</option> <option value="string">String</option> <option value="double">Double</option></select> ' +
                    '</div> ' +
                    '</div>');
            $("#input_entry_div").append(' <div class="form-group"> <label class="col-sm-3 control-label">'+entry_base+' Name <span class="sub-tag"> </span></label> <div class="col-sm-6"> <input class="form-control" name="'+name_entry+'" rows="1" placeholder="Enter Name"></input> </div> </div>');
            $("#input_entry_div").append(' <div class="form-group"> <label class="col-sm-3 control-label">'+entry_base+' Description <span class="sub-tag">This Field is Required</span></label> <div class="col-sm-6"> <textarea class="form-control" name="'+desp_entry+'" rows="1" placeholder="Enter Description"></textarea> </div> </div>');
            $("#input_entry_div").append(' <div class="form-group"> <label class="col-sm-3 control-label">'+entry_base+' Validation Method </label> <div class="col-sm-6"> <textarea class="form-control" name="'+validation_entry+'" rows="1" placeholder="Enter Validation Method if exist"></textarea> </div> </div> <hr>');
        }
        for(var i=0;i<totalOutputs;i++)
        {
            var entry_base='output'+(i+1);
            var type_entry=entry_base+'_type';
            var desp_entry=entry_base+'_desp';
            var dataaction_entry=entry_base+'_dataaction';
            var validation_entry=entry_base+'_validation';
            var name_entry=entry_base+'_name';
            $("#output_entry_div").append('' +
                    ' <div class="form-group"> ' +
                    '<label for="" class="col-sm-3 control-label">'+entry_base+' Data Type<span class="sub-tag">This Field is Required</span></label> ' +
                    '<div class="col-sm-4 padding-less"> <select name="'+type_entry+'" class="form-control"> ' +
                    '<option value="sensordata">Sensor Data</option> <option value="file">File</option> <option value="string">String</option> <option value="double">Double</option><option value="alert">Alert</option></select> ' +
                    '</div> ' +
                    '</div>');
            $("#output_entry_div").append(' <div class="form-group"> <label class="col-sm-3 control-label">'+entry_base+' Name <span class="sub-tag"> </span></label> <div class="col-sm-6"> <input class="form-control" name="'+name_entry+'" rows="1" placeholder="Enter Name"></input> </div> </div>');

            $("#output_entry_div").append('' +
                    ' <div class="form-group"> ' +
                    '<label for="" class="col-sm-3 control-label">'+entry_base+' Data Action <span class="sub-tag">This Field is Required</span></label> ' +
                    '<div class="col-sm-4 padding-less"> <select name="'+dataaction_entry+'" class="form-control"> ' +
                    '<option value="ignore">Ignore</option> <option value="save">Save or Update</option> <option value="delete">Delete</option> <option value="alert">Send Alert</option></select> ' +
                    '</div> ' +
                    '</div>');
            $("#output_entry_div").append(' <div class="form-group"> <label class="col-sm-3 control-label">'+entry_base+' Description <span class="sub-tag">This Field is Required</span></label> <div class="col-sm-6"> <textarea class="form-control" name="'+desp_entry+'" rows="1" placeholder="Enter Description"></textarea> </div> </div><hr>');
           }



        var options = {
            target:        '#output',   // target element(s) to be updated with server response
            beforeSubmit:  showRequest,  // pre-submit callback
            success:       showResponse,  // post-submit callback

            // other available options:
            url:       "http://localhost:8080/healthbook/PostAnalysisService2" ,        // override for form's 'action' attribute
            type:      'post'  ,      // 'get' or 'post', override for form's 'method' attribute
            dataType:  'json'        // 'xml', 'script', or 'json' (expected server response type)
            //clearForm: true        // clear all form fields after successful submit
            //resetForm: true        // reset the form after successful submit

            // $.ajax options can be used here too, for example:
            //timeout:   3000
        };
//
//        $.cookie("totalInputs", totalInputs, { expires: 300 });
//        $.cookie("totalOutputs", totalOutputs, { expires: 300 });


        // bind to the form's submit event
        $('#model_form').submit(function() {
            // inside event callbacks 'this' is the DOM element so we first
            // wrap it in a jQuery object and then invoke ajaxSubmit

            $(this).ajaxSubmit(options);

            return false;
        });
    });

    // pre-submit callback
    function showRequest(formData, jqForm, options) {
        $body = $("body");
        $body.addClass("loading");


        var queryString = $.param(formData);

        var formElement = jqForm[0];

        return true;
    }

    // post-submit callback
    function showResponse(responseText, statusText, xhr, $form)  {
        $body = $("body");
        $body.removeClass("loading");

        var result=responseText;
        if(result.result=='succeed')
        {
//            $.removeCookie('model_id');
//            $.removeCookie('totalInputs');
//            $.removeCookie('totalOutputs');
            window.location = 'service-publish3.html';
        }else{
            alert(result.errorCode+",targetObject:"+result.targetObject);
        }
    }
</script>

<div class="modal"><!-- Place at bottom of page --></div>
</body>
</html>
